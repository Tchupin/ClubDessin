-- Suppression des tables existantes (DROP TABLE IF EXISTS)
DROP TABLE IF EXISTS Jury;
DROP TABLE IF EXISTS ClubParticipe;
DROP TABLE IF EXISTS CompetiteurParticipe;
DROP TABLE IF EXISTS Evaluation;
DROP TABLE IF EXISTS Dessin;
DROP TABLE IF EXISTS Competiteur;
DROP TABLE IF EXISTS Concours;
DROP TABLE IF EXISTS Evaluateur;
DROP TABLE IF EXISTS President;
DROP TABLE IF EXISTS Administrateur;
DROP TABLE IF EXISTS Directeur;
DROP TABLE IF EXISTS Utilisateur;
DROP TABLE IF EXISTS Club;

-- Création des tables
CREATE TABLE Club (
    numClub INT PRIMARY KEY,
    nomClub VARCHAR(100),
    adresse VARCHAR(255),
    numTelephone VARCHAR(15),
    nombreAdherents INT,
    ville VARCHAR(50),
    departement VARCHAR(50),
    region VARCHAR(50)
);

CREATE TABLE Utilisateur (
    numUtilisateur INT PRIMARY KEY,
    nom VARCHAR(50),
    prenom VARCHAR(50),
    adresse VARCHAR(255),
    login VARCHAR(50) UNIQUE,
    motDePasse VARCHAR(50),
    numClub INT,
    FOREIGN KEY (numClub) REFERENCES Club(numClub)
);

CREATE TABLE Directeur (
    dateDebut DATE,
    numDirecteur INT PRIMARY KEY,
    numClub INT,
    FOREIGN KEY (numDirecteur) REFERENCES Utilisateur(numUtilisateur),
    FOREIGN KEY (numClub) REFERENCES Club(numClub)
);

CREATE TABLE Administrateur (
    dateDebut DATE,
    numAdministrateur INT PRIMARY KEY,
    FOREIGN KEY (numAdministrateur) REFERENCES Utilisateur(numUtilisateur)
);

CREATE TABLE President (
    prime DECIMAL(10, 2),
    numPresident INT PRIMARY KEY,
    FOREIGN KEY (numPresident) REFERENCES Utilisateur(numUtilisateur)
);

CREATE TABLE Evaluateur (
    specialite VARCHAR(100),
    numEvaluateur INT PRIMARY KEY,
    FOREIGN KEY (numEvaluateur) REFERENCES Utilisateur(numUtilisateur)
);

CREATE TABLE Concours (
    numConcours INT PRIMARY KEY,
    theme VARCHAR(100),
    dateDebut DATE,
    dateFin DATE,
    etat ENUM('pas commencé', 'en cours', 'attente', 'résultat', 'évalué')
);

CREATE TABLE Competiteur (
    datePremiereParticipation DATE,
    numCompetiteur INT PRIMARY KEY,
    FOREIGN KEY (numCompetiteur) REFERENCES Utilisateur(numUtilisateur)
);

CREATE TABLE Dessin (
    numDessin INT PRIMARY KEY,
    numCompetiteur INT,
    commentaire VARCHAR(255),
    classement INT,
    dateRemise DATE,
    leDessin BLOB,
    numConcours INT,
    FOREIGN KEY (numCompetiteur) REFERENCES Competiteur(numCompetiteur),
    FOREIGN KEY (numConcours) REFERENCES Concours(numConcours)
);

CREATE TABLE Evaluation (
    dateEvaluation DATE,
    note DECIMAL(5, 2),
    commentaire VARCHAR(255),
    numDessin INT,
    numEvaluateur INT,
    PRIMARY KEY (numDessin, numEvaluateur),
    FOREIGN KEY (numDessin) REFERENCES Dessin(numDessin),
    FOREIGN KEY (numEvaluateur) REFERENCES Evaluateur(numEvaluateur)
);

CREATE TABLE CompetiteurParticipe (
    numCompetiteur INT,
    numConcours INT,
    PRIMARY KEY (numCompetiteur, numConcours),
    FOREIGN KEY (numCompetiteur) REFERENCES Competiteur(numCompetiteur),
    FOREIGN KEY (numConcours) REFERENCES Concours(numConcours)
);

CREATE TABLE ClubParticipe (
    numClub INT,
    numConcours INT,
    PRIMARY KEY (numClub, numConcours),
    FOREIGN KEY (numClub) REFERENCES Club(numClub),
    FOREIGN KEY (numConcours) REFERENCES Concours(numConcours)
);

CREATE TABLE Jury (
    numEvaluateur INT,
    numConcours INT,
    PRIMARY KEY (numEvaluateur, numConcours),
    FOREIGN KEY (numEvaluateur) REFERENCES Evaluateur(numEvaluateur),
    FOREIGN KEY (numConcours) REFERENCES Concours(numConcours)
);
